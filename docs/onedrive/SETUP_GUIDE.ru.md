# –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ Microsoft OneDrive OAuth2

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ–º–æ–∂–µ—Ç –≤–∞–º –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é OneDrive OAuth2 –¥–ª—è Marix.

## –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –õ–∏—á–Ω–∞—è —É—á–µ—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å Microsoft
- –î–æ—Å—Ç—É–ø –∫ [–ø–æ—Ä—Ç–∞–ª—É Azure](https://portal.azure.com)

## –®–∞–≥ 1: –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ [–ü–æ—Ä—Ç–∞–ª Azure - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)
2. –ù–∞–∂–º–∏—Ç–µ **"–ù–æ–≤–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è"**
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ:
   - **–ò–º—è**: `Marix SSH Client`
   - **–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ç–∏–ø—ã —É—á–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π**: –í—ã–±–µ—Ä–∏—Ç–µ **"–¢–æ–ª—å–∫–æ –ª–∏—á–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –∑–∞–ø–∏—Å–∏ –ú–∞–π–∫—Ä–æ—Å–æ—Ñ—Ç"**
   - **URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: –û—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –Ω–∞ —à–∞–≥–µ 3)
4. –ù–∞–∂–º–∏—Ç–µ **"–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å"**

## –®–∞–≥ 2: –ó–∞–ø–∏—à–∏—Ç–µ ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
1. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–∫–ª–∏–µ–Ω—Ç–∞)**
2. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –≤ –Ω–∞–¥–µ–∂–Ω–æ–º –º–µ—Å—Ç–µ

## –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ (–°–ª—É—á–∞–π–Ω—ã–π –ø–æ—Ä—Ç)

Marix –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **RFC 8252** —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ loopback —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –ø–æ—Ä—Ç–∞–º–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

1. –ù–∞–∂–º–∏—Ç–µ **"–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏"**
2. –í —Ä–∞–∑–¥–µ–ª–µ **"–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º"** –Ω–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º—É"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"–ú–æ–±–∏–ª—å–Ω—ã–µ –∏ –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"**
4. ‚ö†Ô∏è **–í–∞–∂–Ω–æ**: –î–æ–±–∞–≤—å—Ç–µ –ù–ï–°–ö–û–õ–¨–ö–û URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
   ```
   http://127.0.0.1/callback
   http://127.0.0.1:8888/callback
   http://127.0.0.1:8889/callback
   http://127.0.0.1:8890/callback
   http://127.0.0.1:8891/callback
   http://127.0.0.1:8892/callback
   http://127.0.0.1:8893/callback
   http://127.0.0.1:8894/callback
   http://127.0.0.1:8895/callback
   http://127.0.0.1:8896/callback
   http://127.0.0.1:8897/callback
   ```
5. –¢–∞–∫–∂–µ –æ—Ç–º–µ—Ç—å—Ç–µ: `https://login.microsoftonline.com/common/oauth2/nativeclient`
6. –í —Ä–∞–∑–¥–µ–ª–µ **"–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã"**:
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ **"–†–∞–∑—Ä–µ—à–∏—Ç—å –ø–æ—Ç–æ–∫–∏ –æ–±—â–µ–¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞"** –≤ **–î–∞** ‚ö†Ô∏è
7. –ù–∞–∂–º–∏—Ç–µ **"–°–æ—Ö—Ä–∞–Ω–∏—Ç—å"**

## –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π API

1. –ù–∞–∂–º–∏—Ç–µ **"–†–∞–∑—Ä–µ—à–µ–Ω–∏—è API"**
2. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ"**
3. –í—ã–±–µ—Ä–∏—Ç–µ **"Microsoft Graph"** ‚Üí **"–î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"**
4. –î–æ–±–∞–≤—å—Ç–µ:
   - ‚úÖ `Files.ReadWrite`
   - ‚úÖ `User.Read`
   - ‚úÖ `offline_access`
5. –ù–∞–∂–º–∏—Ç–µ **"–î–æ–±–∞–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è"**

## –®–∞–≥ 5: –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `src/main/services/onedrive-credentials.json`:

```json
{
  "client_id": "–í–ê–®_–ò–î–ï–ù–¢–ò–§–ò–ö–ê–¢–û–†_–ö–õ–ò–ï–ù–¢–ê"
}
```

**–î–ª—è CI/CD —Å–±–æ—Ä–æ–∫**: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ GitHub Secrets (—Å–º. –Ω–∏–∂–µ)

## –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤ Marix

### –í–∞—Ä–∏–∞–Ω—Ç A: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `onedrive-credentials.json` –≤ –ø–∞–ø–∫–µ `src/main/services/`
2. **–í–ê–ñ–ù–û**: –î–æ–±–∞–≤—å—Ç–µ –≤ `.gitignore`:
```
src/main/services/onedrive-credentials.json
```

### –í–∞—Ä–∏–∞–Ω—Ç B: CI/CD —Å GitHub Secrets (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –≤–∞—à GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π ‚Üí **Settings** ‚Üí **Secrets and variables** ‚Üí **Actions**
2. –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç —Å–µ–∫—Ä–µ—Ç:
   - `ONEDRIVE_CLIENT_ID`: –í–∞—à OAuth Application (Client) ID
3. –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω–µ–¥—Ä–∏—Ç —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏

## –®–∞–≥ 7: –°–±–æ—Ä–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
npm run build
npm start
```

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- ‚úÖ **PKCE**: client_secret –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è
- ‚úÖ **RFC 8252**: Loopback –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ —Å–ª—É—á–∞–π–Ω—ã–º–∏ –ø–æ—Ä—Ç–∞–º–∏
- ‚úÖ **E2E —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ**: Argon2id + AES-256-GCM
- üìÅ **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ**: `/Marix/backup.marix`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ **GitHub Secrets** –¥–ª—è CI/CD —Å–±–æ—Ä–æ–∫ –¥–ª—è –∑–∞—â–∏—Ç—ã —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
