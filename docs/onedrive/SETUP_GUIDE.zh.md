# Microsoft OneDrive OAuth2 è®¾ç½®æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©æ‚¨ä¸º Marix è®¾ç½® OneDrive OAuth2 è®¤è¯ã€‚

## å…ˆå†³æ¡ä»¶

- ä¸ªäºº Microsoft å¸æˆ·
- è®¿é—® [Azure é—¨æˆ·](https://portal.azure.com)

## æ­¥éª¤ 1ï¼šæ³¨å†Œæ–°åº”ç”¨ç¨‹åº

1. è½¬åˆ° [Azure é—¨æˆ· - åº”ç”¨æ³¨å†Œ](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)
2. ç‚¹å‡» **"æ–°æ³¨å†Œ"**
3. å¡«å†™è¯¦ç»†ä¿¡æ¯ï¼š
   - **åç§°**ï¼š`Marix SSH Client`
   - **æ”¯æŒçš„å¸æˆ·ç±»å‹**ï¼šé€‰æ‹© **"ä»…ä¸ªäºº Microsoft å¸æˆ·"**
   - **é‡å®šå‘ URI**ï¼šç•™ç©ºï¼ˆå°†åœ¨æ­¥éª¤ 3 ä¸­æ·»åŠ ï¼‰
4. ç‚¹å‡» **"æ³¨å†Œ"**

## æ­¥éª¤ 2ï¼šè®°å½•åº”ç”¨ç¨‹åº ID

æ³¨å†Œåï¼š
1. å¤åˆ¶ **åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ID**
2. ä¿å­˜åœ¨å®‰å…¨çš„åœ°æ–¹

## æ­¥éª¤ 3ï¼šé…ç½®èº«ä»½éªŒè¯ï¼ˆéšæœºç«¯å£ï¼‰

Marix ä½¿ç”¨ **RFC 8252** å…¼å®¹çš„ç¯å›é‡å®šå‘å’Œéšæœºç«¯å£ä»¥æé«˜å®‰å…¨æ€§ã€‚

1. ç‚¹å‡» **"èº«ä»½éªŒè¯"**
2. åœ¨ **"å¹³å°é…ç½®"** ä¸‹ï¼Œç‚¹å‡» **"æ·»åŠ å¹³å°"**
3. é€‰æ‹© **"ç§»åŠ¨å’Œæ¡Œé¢åº”ç”¨ç¨‹åº"**
4. âš ï¸ **é‡è¦**ï¼šæ·»åŠ å¤šä¸ªé‡å®šå‘ URIï¼š
   ```
   http://127.0.0.1/callback
   http://127.0.0.1:8888/callback
   http://127.0.0.1:8889/callback
   http://127.0.0.1:8890/callback
   http://127.0.0.1:8891/callback
   http://127.0.0.1:8892/callback
   http://127.0.0.1:8893/callback
   http://127.0.0.1:8894/callback
   http://127.0.0.1:8895/callback
   http://127.0.0.1:8896/callback
   http://127.0.0.1:8897/callback
   ```
5. è¿˜è¦å‹¾é€‰ï¼š`https://login.microsoftonline.com/common/oauth2/nativeclient`
6. åœ¨ **"é«˜çº§è®¾ç½®"** ä¸‹ï¼š
   - å°† **"å…è®¸å…¬å…±å®¢æˆ·ç«¯æµ"** è®¾ç½®ä¸º **æ˜¯** âš ï¸
7. ç‚¹å‡» **"ä¿å­˜"**

## æ­¥éª¤ 4ï¼šé…ç½® API æƒé™

1. ç‚¹å‡» **"API æƒé™"**
2. ç‚¹å‡» **"æ·»åŠ æƒé™"**
3. é€‰æ‹© **"Microsoft Graph"** â†’ **"å§”æ‰˜çš„æƒé™"**
4. æ·»åŠ ï¼š
   - âœ… `Files.ReadWrite`
   - âœ… `User.Read`
   - âœ… `offline_access`
5. ç‚¹å‡» **"æ·»åŠ æƒé™"**

## æ­¥éª¤ 5ï¼šåˆ›å»ºå‡­æ®æ–‡ä»¶

**ç”¨äºæœ¬åœ°å¼€å‘**ï¼šç¼–è¾‘ `src/main/services/onedrive-credentials.json`ï¼š

```json
{
  "client_id": "æ‚¨çš„å®¢æˆ·ç«¯ID"
}
```

**ç”¨äº CI/CD æ„å»º**ï¼šä½¿ç”¨ GitHub Secretsï¼ˆè§ä¸‹æ–‡ï¼‰

## æ­¥éª¤ 6ï¼šåœ¨ Marix ä¸­é…ç½®

### é€‰é¡¹ Aï¼šæœ¬åœ°å¼€å‘

1. åœ¨ `src/main/services/` æ–‡ä»¶å¤¹ä¸­åˆ›å»º `onedrive-credentials.json` æ–‡ä»¶
2. **é‡è¦**ï¼šæ·»åŠ åˆ° `.gitignore`ï¼š
```
src/main/services/onedrive-credentials.json
```

### é€‰é¡¹ Bï¼šä½¿ç”¨ GitHub Secrets çš„ CI/CDï¼ˆæ¨èï¼‰

1. è½¬åˆ°æ‚¨çš„ GitHub ä»“åº“ â†’ **Settings** â†’ **Secrets and variables** â†’ **Actions**
2. æ·»åŠ æ­¤ secretï¼š
   - `ONEDRIVE_CLIENT_ID`ï¼šæ‚¨çš„ OAuth åº”ç”¨ç¨‹åºï¼ˆå®¢æˆ·ç«¯ï¼‰ID
3. æ„å»ºå·¥ä½œæµå°†åœ¨æ„å»ºæœŸé—´è‡ªåŠ¨æ³¨å…¥å‡­æ®

## æ­¥éª¤ 7ï¼šæ„å»ºå’Œæµ‹è¯•

```bash
npm run build
npm start
```

## å®‰å…¨è¯´æ˜

- âœ… **PKCE**ï¼šæ— éœ€ client_secret
- âœ… **RFC 8252**ï¼šä½¿ç”¨éšæœºç«¯å£çš„ç¯å›é‡å®šå‘
- âœ… **ç«¯åˆ°ç«¯åŠ å¯†**ï¼šArgon2id + AES-256-GCM
- ğŸ“ **å­˜å‚¨ä½ç½®**ï¼š`/Marix/backup.marix`
- ä½¿ç”¨ **GitHub Secrets** è¿›è¡Œ CI/CD æ„å»ºä»¥ä¿æŠ¤å‡­æ®
